<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>
<div class="container">
    <div class="top-right">
        <a href="{{ url_for('main.index') }}">🏠 Startseite</a>
        <a href="{{ url_for('main.logout') }}">Logout</a>
    </div>

    <h1>⚡ Admin Dashboard</h1>

    <h2>Neue Wette anlegen</h2>
    <form method="POST" action="{{ url_for('admin.add_bet') }}" class="auth-form">
        <input type="text" name="title" placeholder="Titel" required>
        <input type="text" name="description" placeholder="Beschreibung">
        <input type="text" name="option1" placeholder="Option 1" required>
        <input type="text" name="option2" placeholder="Option 2" required>
        <input type="text" name="option3" placeholder="Option 3 (optional)">
        <input type="text" name="option4" placeholder="Option 4 (optional)">
        <input type="text" id="deadline" name="deadline" placeholder="Deadline">
        <button type="submit">➕ Hinzufügen</button>
    </form>

    <h2>Bestehende Wetten</h2>
    <div class="bet-list">
        {% for bet in bets %}
        <div class="bet-card">
            <h2>{{ bet.title }}</h2>
            <p>{{ bet.description }}</p>
            <span class="status">{{ bet.status }}</span>
            {% if bet.deadline %}
                <p style="font-size:0.85rem; color:#888;">
                    Ablauf: {{ bet.deadline.strftime('%Y-%m-%d %H:%M') }}
                </p>
            {% endif %}

            <!-- Statistik-Balken -->
            <div class="vote-stats">
                {% set total_votes = bets_stats[bet.id].values() | sum %}
                {% for option, votes in bets_stats[bet.id].items() %}
                    {% set percent = (votes / total_votes * 100) if total_votes > 0 else 0 %}
                    <div class="stat-bar-container">
                        <div class="stat-bar" style="width: {{ percent }}%;"></div>
                        <span>{{ option }}: {{ votes }} Stimmen ({{ percent|round(1) }}%)</span>
                    </div>
                {% endfor %}
            </div>

            <div class="vote-buttons">
                <a href="{{ url_for('admin.toggle_bet', bet_id=bet.id) }}">
                    {% if bet.status == 'active' %}🔒 Schließen{% else %}🔓 Öffnen{% endif %}
                </a>
                <a href="{{ url_for('admin.delete_bet', bet_id=bet.id) }}" style="color: red;">🗑️ Löschen</a>
                <a href="{{ url_for('admin.bet_detail', bet_id=bet.id) }}">✏️ Bearbeiten</a>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Flatpickr JS -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
    flatpickr("#deadline", {
        enableTime: true,
        dateFormat: "Y-m-d H:i",
        time_24hr: true
    });
</script>
</body>
</html>
